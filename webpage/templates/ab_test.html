<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>A/B Test Results</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #fafafa; color:#1f2d3d;}
    h1 { color: #2c3e50; margin-bottom: 12px; }
    .summary { background:#f4f7ff; border:1px solid #dbe5ff; border-radius:12px; padding:12px 14px; margin: 0 0 16px; }
    .summary b { color:#1f50b5; }
    table { border-collapse: collapse; width: 640px; max-width: 100%; background: #fff; }
    th, td { border: 1px solid #e6e6e6; padding: 8px 10px; font-size: 14px; }
    th { background: #f7f7f7; text-align: left; }
    .ok { color: #2e7d32; font-weight: 600; }
    .warn { color: #c62828; font-weight: 600; }
    .note { font-size: 12px; color: #666; margin-top: 8px; }
    a { color: #2c3e50; text-decoration: none; }
    details { margin-top: 10px; }
    details > summary { cursor:pointer; color:#334155; font-weight:600; }
    .pill { display:inline-block; font-size:11px; padding:3px 8px; border-radius:999px; margin-left:6px; background:#eef2ff; color:#3730a3; border:1px solid #c7d2fe; }
    .help { display:inline-flex; align-items:center; justify-content:center; width:18px; height:18px; border-radius:50%; background:#eef2ff; color:#374151; font-weight:700; font-size:12px; margin-left:6px; position:relative; cursor:help; }
    .help::after {
      content: attr(data-tip);
      position: absolute; left: 50%; transform: translateX(-50%);
      bottom: 125%; white-space: nowrap;
      background: #111827; color:#fff; font-size:12px; padding:6px 8px; border-radius:6px; opacity:0; pointer-events:none;
      transition:.15s; box-shadow:0 6px 18px rgba(0,0,0,.15);
    }
    .help:hover::after { opacity:1; }
  </style>
</head>
<body>
  <h1>üìä A/B Test Results</h1>

  {% if results.error %}
    <p class="warn">Error: {{ results.error }}</p>
  {% else %}

    <!-- Friendly one-line takeaway -->
    <div class="summary">
      <div><b>Summary:</b>
        {{ results.group_b_label or "Group B" }} mean = <b>{{ results.group_b_avg }}</b>,
        {{ results.group_a_label or "Group A" }} mean = <b>{{ results.group_a_avg }}</b>,
        Œî = <b>{{ results.mean_diff }}</b>.
        p = <b>{{ results.p_value }}</b> ‚Üí <b class="{{ 'ok' if results.conclusion == 'Significant' else 'warn' }}">{{ results.conclusion }}</b> at Œ± = {{ results.alpha }}.
      </div>
      <div class="note">
        Effect size: <b>{{ results.effect_label or '‚Äî' }}</b>
        {% if results.ci95 %}
          ‚Ä¢ 95% CI for Œî: <b>[{{ results.ci95[0] }}, {{ results.ci95[1] }}]</b>
          {% if results.ci_includes_zero %}(includes 0 ‚Üí result may be inconclusive){% endif %}
        {% endif %}
        {% if results.power_note %} ‚Ä¢ {{ results.power_note }}{% endif %}
        {% if results.imbalance_note %} ‚Ä¢ {{ results.imbalance_note }}{% endif %}
      </div>
    </div>

    <table>
      <tr><th>Metric</th><th>Value</th></tr>
      <tr><td>Group A size (n‚Çê)</td><td>{{ results.n_a }}</td></tr>
      <tr><td>Group B size (n_b)</td><td>{{ results.n_b }}</td></tr>
      <tr><td>Group A Avg Rating ({{ results.group_a_label or 'A' }})</td><td>{{ results.group_a_avg }}</td></tr>
      <tr><td>Group B Avg Rating ({{ results.group_b_label or 'B' }})</td><td>{{ results.group_b_avg }}</td></tr>
      <tr><td>Mean difference (B ‚àí A)</td><td>{{ results.mean_diff }}</td></tr>
      <tr><td>t-statistic (Welch)</td><td>{{ results.t_stat }}</td></tr>
      <tr><td>p-value</td><td>{{ results.p_value }}</td></tr>
      <tr>
        <td>95% CI (mean diff)
          <span class="help" data-tip="If the interval crosses 0, the direction is uncertain at 95% confidence.">?</span>
        </td>
        <td>
          {% if results.ci95 %}
            [{{ results.ci95[0] }}, {{ results.ci95[1] }}]
          {% else %}
            N/A
          {% endif %}
        </td>
      </tr>
      <tr>
        <td>Cohen‚Äôs d (effect size)
          <span class="help" data-tip="~0.2=small, ~0.5=medium, ~0.8=large">?</span>
        </td>
        <td>
          {% if results.cohens_d is not none %}
            {{ results.cohens_d }} <span class="pill">{{ results.effect_label }}</span>
          {% else %} N/A {% endif %}
        </td>
      </tr>
      <tr>
        <td>Conclusion</td>
        <td>
          {% if results.conclusion == "Significant" %}
            <span class="ok">{{ results.conclusion }}</span>
          {% else %}
            <span class="warn">{{ results.conclusion }}</span>
          {% endif %}
        </td>
      </tr>
    </table>

    <details>
      <summary>How this is calculated</summary>
      <ul>
        <li>Users are split into <b>Group A</b> (CF) and <b>Group B</b> (Hybrid) by a deterministic MD5 parity of <code>user_id</code> so the same user always stays in the same group.</li>
        <li>We compare average ratings with a <b>Welch‚Äôs t-test</b> (robust to unequal variances/sizes).</li>
        <li>We also report <b>Cohen‚Äôs d</b> for effect size and a non-parametric <b>bootstrap 95% CI</b> for the mean difference.</li>
        <li>‚ÄúSignificant‚Äù means <b>p &lt; Œ±</b> (Œ± defaults to 0.05).</li>
      </ul>
    </details>

    <p class="note" style="margin-top:10px;">
      Assignment uses deterministic MD5 parity for user ‚Üí variant. ‚ÄúSignificant‚Äù means p &lt; {{ results.alpha or 0.05 }}.
    </p>
  {% endif %}

  <p style="margin-top: 20px;"><a href="/">‚Üê Back to Home</a></p>
</body>
</html>
